@use "prefixes" as *;
@use "defines" as *;

// ============================================
// Palette Color Definitions
// ============================================

// 明度リスト（0-10）
$palette-lightness-list: (
  0: 97%,
  1: 93%,
  2: 85%,
  3: 75%,
  4: 65%,
  5: 50%,
  6: 42%,
  7: 34%,
  8: 26%,
  9: 18%,
  10: 10%
) !default;

// ============================================
// Palette Color Generation Mixin
// $threshold: Accent Color Threshold
// ============================================
@mixin _generate-palette-colors($threshold: $palette-accent-threshold) {
  @each $index, $lightness in $palette-lightness-list {
    --#{$palette-lightness-prefix}#{$index}: #{$lightness};
  }

  @each $index, $lightness in $palette-lightness-list {
    --#{$palette-color-prefix}#{$index}: hsl(var(--#{$palette-hue-prefix}), var(--#{$palette-saturation-prefix}), var(--#{$palette-lightness-prefix}#{$index}));
  }

  @each $index, $lightness in $palette-lightness-list {
    --#{$palette-gray-prefix}#{$index}: hsl(var(--#{$palette-hue-prefix}), var(--#{$palette-gray-saturation-prefix}), var(--#{$palette-lightness-prefix}#{$index}));
  }

  @each $index, $lightness in $palette-lightness-list {
    @if $lightness > $threshold {
      --#{$palette-accent-prefix}#{$index}: hsl(var(--#{$palette-hue-prefix}), var(--#{$palette-gray-saturation-prefix}), var(--#{$palette-accent-dark-var}));
    } @else {
      --#{$palette-accent-prefix}#{$index}: hsl(var(--#{$palette-hue-prefix}), var(--#{$palette-gray-saturation-prefix}), var(--#{$palette-accent-light-var}));
    }
  }
}

// ============================================
// HUE Color Generation Mixin
// $hues: ("red": 0, ...)
// $accent-light: Accent Lightness
// $accent-dark: Accent Darkness
// $default-threshold: Default Accent Threshold
// ============================================
@mixin generate-hues($hues, $accent-light: $palette-accent-light, $accent-dark: $palette-accent-dark, $default-threshold: $palette-accent-threshold) {
  :root {
    @each $name, $value in $hues {
      @if type-of($value) == "map" {
        --#{$prefix}hue-#{$name}: #{map-get($value, h)};
      } @else {
        --#{$prefix}hue-#{$name}: #{$value};
      }
    }

    --#{$palette-accent-light-var}: #{$accent-light};
    --#{$palette-accent-dark-var}: #{$accent-dark};
    --#{$palette-accent-threshold-var}: #{$default-threshold};
  }
}

// ============================================
// HUE Class Generation Mixin
// $hues: ("red": 0, ...)
// $saturation: Saturation for HUE Classes
// $gray-saturation: Gray Saturation for HUE Classes
// $default-threshold: Default Accent Threshold
// ============================================
@mixin generate-hue-classes($hues, $saturation: 100%, $gray-saturation: 5%, $default-threshold: $palette-accent-threshold) {
  @each $name, $value in $hues {
    $threshold: $default-threshold;
    @if type-of($value) == "map" and map-has-key($value, threshold) {
      $threshold: map-get($value, threshold);
    }

    .#{$prefix}#{$name} {
      --#{$palette-hue-prefix}: var(--#{$prefix}hue-#{$name});
      --#{$palette-saturation-prefix}: #{$saturation};
      --#{$palette-gray-saturation-prefix}: #{$gray-saturation};
      --#{$palette-accent-threshold-var}: #{$threshold};
      @include _generate-palette-colors($threshold);
    }
  }
}

// ============================================
// Semantic Color Generation Mixin
// $colors: ( "primary": (h: , s: , threshold: , levels: ()), ... )
// $gray-saturation: Gray Saturation for Semantic Colors
// $default-threshold: Default Accent Threshold
// $default-levels: Default Levels Mapping
// ============================================
@mixin generate-semantic-colors($colors, $gray-saturation: 5%, $default-threshold: $palette-accent-threshold, $default-levels: $semantic-levels) {
  :root {
    @each $level-name, $palette-index in $default-levels {
      --#{$semantic-level-prefix}#{$level-name}: #{$palette-index};
    }

    @each $name, $values in $colors {
      --#{$semantic-prefix}#{$name}-h: #{map-get($values, h)};
      --#{$semantic-prefix}#{$name}-s: #{map-get($values, s)};
    }
  }

  @each $name, $values in $colors {
    $threshold: $default-threshold;
    @if map-has-key($values, threshold) {
      $threshold: map-get($values, threshold);
    }

    $levels: $default-levels;
    @if map-has-key($values, levels) {
      $custom-levels: map-get($values, levels);
      @each $level-name, $palette-index in $custom-levels {
        $levels: map-merge($levels, ($level-name: $palette-index));
      }
    }

    .#{$semantic-prefix}#{$name} {
      --#{$palette-hue-prefix}: var(--#{$semantic-prefix}#{$name}-h);
      --#{$palette-saturation-prefix}: var(--#{$semantic-prefix}#{$name}-s);
      --#{$palette-gray-saturation-prefix}: #{$gray-saturation};
      --#{$palette-accent-threshold-var}: #{$threshold};
      @include _generate-palette-colors($threshold);

      --#{$palette-lighter}: var(--#{$palette-color-prefix}#{map-get($levels, "lighter")});
      --#{$palette-light}: var(--#{$palette-color-prefix}#{map-get($levels, "light")});
      --#{$palette-default}: var(--#{$palette-color-prefix}#{map-get($levels, "default")});
      --#{$palette-dark}: var(--#{$palette-color-prefix}#{map-get($levels, "dark")});
      --#{$palette-darker}: var(--#{$palette-color-prefix}#{map-get($levels, "darker")});

      --#{$palette-lighter-accent}: var(--#{$palette-accent-prefix}#{map-get($levels, "lighter")});
      --#{$palette-light-accent}: var(--#{$palette-accent-prefix}#{map-get($levels, "light")});
      --#{$palette-default-accent}: var(--#{$palette-accent-prefix}#{map-get($levels, "default")});
      --#{$palette-dark-accent}: var(--#{$palette-accent-prefix}#{map-get($levels, "dark")});
      --#{$palette-darker-accent}: var(--#{$palette-accent-prefix}#{map-get($levels, "darker")});
    }
  }
}


// ============================================
// Neutral Palette Definitions
// ============================================
$neutral-hue: 220 !default;
$neutral-saturation: 5% !default;
$neutral-threshold: $palette-accent-threshold !default;
$neutral-levels: $semantic-levels !default;

// ============================================
// Neutral Palette Generation
// ============================================
:root {
  --#{$neutral-accent-threshold-var}: #{$neutral-threshold};

  @each $index, $lightness in $palette-lightness-list {
    --#{$neutral-prefix}#{$index}: hsl(var(--#{$neutral-hue-var}), var(--#{$neutral-saturation-var}), #{$lightness});
  }

  @each $index, $lightness in $palette-lightness-list {
    @if $lightness > $neutral-threshold {
      --#{$neutral-prefix}accent-#{$index}: hsl(var(--#{$neutral-hue-var}), var(--#{$neutral-saturation-var}), var(--#{$palette-accent-dark-var}));
    } @else {
      --#{$neutral-prefix}accent-#{$index}: hsl(var(--#{$neutral-hue-var}), var(--#{$neutral-saturation-var}), var(--#{$palette-accent-light-var}));
    }
  }
}

@include generate-semantic-colors((
  "neutral": (
    h: $neutral-hue,
    s: $neutral-saturation,
    threshold: $neutral-threshold,
    levels: $neutral-levels
  )
));

@include generate-hues($hues);
@include generate-hue-classes($hues);
@include generate-semantic-colors($semantic-colors);