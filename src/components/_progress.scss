@use "../props/prefixes" as *;

// ============================================
// Prefixes
// ============================================
// Prefixes
$progress-prefix: #{$prefix}progress- !default;

// Class Names
$progress-class-name: "progress" !default;

// Variable Names
$progress-height-var: --#{$progress-prefix}height !default;
$progress-bg-var: --#{$progress-prefix}bg !default;
$progress-border-radius-var: --#{$progress-prefix}border-radius !default;
$progress-border-width-var: --#{$progress-prefix}border-width !default;
$progress-border-color-var: --#{$progress-prefix}border-color !default;
$progress-value-bg-var: --#{$progress-prefix}value-bg !default;
$progress-value-border-radius-var: --#{$progress-prefix}value-border-radius !default;
$progress-transition-var: --#{$progress-prefix}transition !default;
$progress-indeterminate-duration-var: --#{$progress-prefix}indeterminate-duration !default;
$progress-indeterminate-width-var: --#{$progress-prefix}indeterminate-width !default;

// ============================================
// Process
// ============================================
// ============================================
// CSS Variables
// ============================================
.#{$progress-class-name} {
  #{$progress-height-var}: 0.5rem;
  #{$progress-bg-var}: #e5e7eb;
  #{$progress-border-radius-var}: 0.25rem;
  #{$progress-border-width-var}: 0;
  #{$progress-border-color-var}: transparent;

  #{$progress-value-bg-var}: #3b82f6;
  #{$progress-value-border-radius-var}: 0.25rem;

  #{$progress-transition-var}: width 0.3s ease-in-out;
  #{$progress-indeterminate-duration-var}: 1.5s;
  #{$progress-indeterminate-width-var}: 30%;
}

// ============================================
// Progress
// ============================================
.#{$progress-class-name},
progress.#{$progress-class-name} {
  // Reset browser default
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;

  // Size
  display: block;
  width: 100%;
  height: var(#{$progress-height-var});

  // For Firefox
  background: var(#{$progress-bg-var});
  border: var(#{$progress-border-width-var}) solid
    var(#{$progress-border-color-var});
  border-radius: var(#{$progress-border-radius-var});

  // Remove default styling
  overflow: hidden;

  // ----------------------------------------
  // WebKit Background (Chrome, Safari, Edge)
  // ----------------------------------------
  &::-webkit-progress-bar {
    background: var(#{$progress-bg-var});
    border-radius: var(#{$progress-border-radius-var});
  }

  // ----------------------------------------
  // WebKit Value (Chrome, Safari, Edge)
  // ----------------------------------------
  &::-webkit-progress-value {
    background: var(#{$progress-value-bg-var});
    border-radius: var(#{$progress-value-border-radius-var});
    transition: var(#{$progress-transition-var});
  }

  // ----------------------------------------
  // Mozilla Value (Firefox)
  // ----------------------------------------
  &::-moz-progress-bar {
    background: var(#{$progress-value-bg-var});
    border-radius: var(#{$progress-value-border-radius-var});
    transition: var(#{$progress-transition-var});
  }
}

// ============================================
// Indeterminate Progress (native <progress>)
// ============================================
// Note: Indeterminate state is applied when no value attribute is set
// <progress class="progress"></progress>

progress.#{$progress-class-name}:indeterminate {
  // WebKit
  &::-webkit-progress-bar {
    background: var(#{$progress-bg-var});
  }

  &::-webkit-progress-value {
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(#{$progress-value-bg-var}) 50%,
      transparent 100%
    );
    animation: progress-indeterminate
      var(#{$progress-indeterminate-duration-var}) linear infinite;
  }

  // Firefox - uses different pseudo-element
  &::-moz-progress-bar {
    background: linear-gradient(
      90deg,
      transparent 0%,
      var(#{$progress-value-bg-var}) 50%,
      transparent 100%
    );
    animation: progress-indeterminate
      var(#{$progress-indeterminate-duration-var}) linear infinite;
  }
}

// ============================================
// Indeterminate Animation Keyframes
// ============================================
@keyframes progress-indeterminate {
  0% {
    margin-left: -30%;
    width: var(#{$progress-indeterminate-width-var});
  }
  100% {
    margin-left: 100%;
    width: var(#{$progress-indeterminate-width-var});
  }
}

// ============================================
// DIV-based Progress (for more control)
// ============================================
// Usage:
// <div class="progress-bar">
//     <div class="progress-bar-value" style="width: 50%"></div>
// </div>

.progress-bar {
  display: flex;
  width: 100%;
  height: var(#{$progress-height-var});
  background: var(#{$progress-bg-var});
  border: var(#{$progress-border-width-var}) solid
    var(#{$progress-border-color-var});
  border-radius: var(#{$progress-border-radius-var});
  overflow: hidden;
}

.progress-bar-value {
  height: 100%;
  background: var(#{$progress-value-bg-var});
  border-radius: var(#{$progress-value-border-radius-var});
  transition: var(#{$progress-transition-var});
}

// ----------------------------------------
// DIV-based Indeterminate
// ----------------------------------------
.progress-bar.indeterminate .progress-bar-value {
  width: var(#{$progress-indeterminate-width-var});
  animation: progress-bar-indeterminate
    var(#{$progress-indeterminate-duration-var}) ease-in-out infinite;
}

@keyframes progress-bar-indeterminate {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(
      calc(100% / var(#{$progress-indeterminate-width-var}) * 100%)
    );
  }
}

// Alternative animation for indeterminate (smoother)
.progress-bar.indeterminate-pulse .progress-bar-value {
  width: 100%;
  animation: progress-pulse var(#{$progress-indeterminate-duration-var})
    ease-in-out infinite;
}

@keyframes progress-pulse {
  0%,
  100% {
    opacity: 0.3;
  }
  50% {
    opacity: 1;
  }
}

// ============================================
// Striped Variant
// ============================================
.progress-striped {
  .progress-bar-value {
    background-image: linear-gradient(
      45deg,
      rgba(255, 255, 255, 0.15) 25%,
      transparent 25%,
      transparent 50%,
      rgba(255, 255, 255, 0.15) 50%,
      rgba(255, 255, 255, 0.15) 75%,
      transparent 75%,
      transparent
    );
    background-size: 1rem 1rem;
  }

  &.animated .progress-bar-value {
    animation: progress-stripes 1s linear infinite;
  }
}

@keyframes progress-stripes {
  0% {
    background-position: 1rem 0;
  }
  100% {
    background-position: 0 0;
  }
}

// Size variants belong in theme layer; core exposes single height variable.

// ============================================
// With Label (DIV-based only)
// ============================================
// Usage:
// <div class="progress-bar progress-bar-labeled">
//     <div class="progress-bar-value" style="width: 75%">
//         <span class="progress-bar-label">75%</span>
//     </div>
// </div>

.progress-bar-labeled {
  .progress-bar-value {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 2rem;
  }
}

.progress-bar-label {
  font-size: 0.75rem;
  font-weight: 500;
  color: white;
  padding: 0 0.5rem;
  white-space: nowrap;
}

// ============================================
// Stacked Progress (multiple values)
// ============================================
// Usage:
// <div class="progress-bar progress-stacked">
//     <div class="progress-bar-value primary" style="width: 30%"></div>
//     <div class="progress-bar-value success" style="width: 20%"></div>
//     <div class="progress-bar-value warning" style="width: 15%"></div>
// </div>

.progress-stacked {
  .progress-bar-value {
    border-radius: 0;

    &:first-child {
      border-radius: var(#{$progress-value-border-radius-var}) 0 0
        var(#{$progress-value-border-radius-var});
    }
    &:last-child {
      border-radius: 0 var(#{$progress-value-border-radius-var})
        var(#{$progress-value-border-radius-var}) 0;
    }
    &:only-child {
      border-radius: var(#{$progress-value-border-radius-var});
    }
  }
}
